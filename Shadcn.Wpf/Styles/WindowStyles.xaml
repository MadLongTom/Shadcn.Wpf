<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:Shadcn.Wpf.Controls"
                    xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework">

    <!-- Local Converters -->
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

    <!-- Window Icon Resources -->
    <PathGeometry x:Key="MinimizeIcon" Figures="M2 12 L22 12"/>
    <PathGeometry x:Key="MaximizeIcon" Figures="M8 3 L5 3 Q3 3 3 5 L3 8 M16 3 L19 3 Q21 3 21 5 L21 8 M21 16 L21 19 Q21 21 19 21 L16 21 M8 21 L5 21 Q3 21 3 19 L3 16"/>
    <PathGeometry x:Key="RestoreIcon" Figures="M8 8 L16 8 L16 16 L8 16 Z M4 4 L12 4 L12 6 M6 4 L6 12 L8 12"/>
    <PathGeometry x:Key="CloseIcon" Figures="M18 6 L6 18 M6 6 L18 18"/>

    <!-- System Button Style -->
    <Style x:Key="ShadcnWindowSystemButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
        <Setter Property="BorderThickness" Value="{DynamicResource BorderNone}"/>
        <Setter Property="Width" Value="{DynamicResource ControlHeightMd}"/>
        <Setter Property="Height" Value="{Binding TitleBarHeight, RelativeSource={RelativeSource AncestorType={x:Type controls:ShadcnWindow}}}"/>
        <Setter Property="HorizontalContentAlignment" Value="Center"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="shell:WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="ButtonBorder"
                            Background="{TemplateBinding Background}"
                            BorderThickness="0">
                        <Path x:Name="ButtonIcon"
                              Data="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"
                              Stroke="{TemplateBinding Foreground}"
                              StrokeThickness="1.5"
                              Stretch="Uniform"
                              Width="{DynamicResource IconSizeMd}"
                              Height="{DynamicResource IconSizeMd}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              UseLayoutRounding="True"
                              SnapsToDevicePixels="True"
                              RenderOptions.EdgeMode="Unspecified"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" 
                                    Value="{DynamicResource SecondaryBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" 
                                    Value="{DynamicResource MutedBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Close Button Style -->
    <Style x:Key="ShadcnWindowCloseButtonStyle" TargetType="Button">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
        <Setter Property="BorderThickness" Value="{DynamicResource BorderNone}"/>
        <Setter Property="Width" Value="{DynamicResource ControlHeightMd}"/>
        <Setter Property="Height" Value="{Binding TitleBarHeight, RelativeSource={RelativeSource AncestorType={x:Type controls:ShadcnWindow}}}"/>
        <Setter Property="HorizontalContentAlignment" Value="Center"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="shell:WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="ButtonBorder"
                            Background="{TemplateBinding Background}"
                            BorderThickness="0">
                        <Path x:Name="ButtonIcon"
                              Data="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}"
                              Stroke="{TemplateBinding Foreground}"
                              StrokeThickness="1.5"
                              Stretch="Uniform"
                              Width="{DynamicResource IconSizeMd}"
                              Height="{DynamicResource IconSizeMd}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              UseLayoutRounding="True"
                              SnapsToDevicePixels="True"
                              RenderOptions.EdgeMode="Unspecified"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" 
                                    Value="{DynamicResource DestructiveBrush}"/>
                            <Setter TargetName="ButtonIcon" Property="Stroke" 
                                    Value="{DynamicResource DestructiveForegroundBrush}"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" 
                                    Value="{DynamicResource DestructiveBrush}"/>
                            <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.8"/>
                            <Setter TargetName="ButtonIcon" Property="Stroke" 
                                    Value="{DynamicResource DestructiveForegroundBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ShadcnWindow Template -->
    <ControlTemplate x:Key="ShadcnWindowTemplate" TargetType="{x:Type controls:ShadcnWindow}">
        <!-- 外层容器，为阴影留出空间 -->
        <Grid x:Name="PART_ShadowContainer" Margin="{DynamicResource SpacingXl}">
            <Border x:Name="PART_WindowBorder"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    BorderThickness="0"
                    CornerRadius="{DynamicResource RadiusLg}">
                <Border.Effect>
                    <DropShadowEffect Color="Black"
                                      Direction="270"
                                      ShadowDepth="8"
                                      BlurRadius="20"
                                      Opacity="0.3"/>
                </Border.Effect>
                
                <!-- 内层Border，实际的窗口边框和背景 -->
                <Border x:Name="PART_InnerBorder"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="{DynamicResource BorderThin}"
                        CornerRadius="{DynamicResource RadiusLg}">
            
            <Grid>
                <Grid.RowDefinitions>
                    <!-- Title Bar -->
                    <RowDefinition Height="{Binding TitleBarHeight, RelativeSource={RelativeSource TemplatedParent}}"/>
                    <!-- Content -->
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Title Bar -->
                <Border x:Name="PART_TitleBar"
                        Grid.Row="0"
                        Background="Transparent"
                        BorderThickness="{DynamicResource BorderBottomThin}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        CornerRadius="8,8,0,0"
                        Visibility="{Binding ShowTitleBar, RelativeSource={RelativeSource TemplatedParent}, 
                                           Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <!-- Icon and Title -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Custom Content -->
                            <ColumnDefinition Width="*"/>
                            <!-- System Buttons -->
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Icon and Title -->
                        <StackPanel Grid.Column="0"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="12,0,0,0">
                            <!-- Window Icon -->
                            <Image x:Name="PART_WindowIcon"
                                   Source="{TemplateBinding Icon}"
                                   Width="16"
                                   Height="16"
                                   Margin="0,0,8,0"
                                   VerticalAlignment="Center"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   RenderOptions.EdgeMode="Unspecified"
                                   UseLayoutRounding="True"
                                   SnapsToDevicePixels="True"
                                   Visibility="{Binding ShowIcon, RelativeSource={RelativeSource TemplatedParent}, 
                                              Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            
                            <!-- Window Title -->
                            <TextBlock x:Name="PART_WindowTitle"
                                       Text="{TemplateBinding Title}"
                                       Foreground="{DynamicResource ForegroundBrush}"
                                       FontFamily="{DynamicResource DefaultFontFamily}"
                                       FontSize="{DynamicResource FontSizeSm}"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center"
                                       UseLayoutRounding="True"
                                       SnapsToDevicePixels="True"
                                       TextOptions.TextFormattingMode="Display"
                                       TextOptions.TextRenderingMode="ClearType"
                                       TextOptions.TextHintingMode="Fixed"/>
                        </StackPanel>

                        <!-- Custom Title Bar Content -->
                        <ContentPresenter Grid.Column="1"
                                          Content="{TemplateBinding TitleBarContent}"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="12,0"/>

                        <!-- System Buttons -->
                        <StackPanel x:Name="PART_SystemButtons"
                                    Grid.Column="2"
                                    Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Visibility="{Binding ShowSystemButtons, RelativeSource={RelativeSource TemplatedParent}, 
                                               Converter={StaticResource BooleanToVisibilityConverter}}">
                            
                            <!-- Minimize Button -->
                            <Button x:Name="PART_MinimizeButton"
                                    Style="{StaticResource ShadcnWindowSystemButtonStyle}"
                                    Command="{TemplateBinding MinimizeCommand}"
                                    Tag="{StaticResource MinimizeIcon}"
                                    ToolTip="最小化"/>
                            
                            <!-- Maximize/Restore Button -->
                            <Button x:Name="PART_MaximizeRestoreButton"
                                    Style="{StaticResource ShadcnWindowSystemButtonStyle}"
                                    Command="{TemplateBinding MaximizeRestoreCommand}"
                                    Tag="{StaticResource MaximizeIcon}"
                                    ToolTip="最大化"/>
                            
                            <!-- Close Button -->
                            <Button x:Name="PART_CloseButton"
                                    Style="{StaticResource ShadcnWindowCloseButtonStyle}"
                                    Command="{TemplateBinding CloseCommand}"
                                    Tag="{StaticResource CloseIcon}"
                                    ToolTip="关闭"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Window Content -->
                <Border Grid.Row="1"
                        x:Name="PART_WindowContent"
                        Background="Transparent"
                        CornerRadius="0,0,8,8">
                    <ContentPresenter Content="{TemplateBinding Content}"
                                      ContentTemplate="{TemplateBinding ContentTemplate}"
                                      Margin="0"/>
                </Border>
            </Grid>
                </Border>
            </Border>
        </Grid>

        <ControlTemplate.Triggers>
            <!-- Window State Triggers -->
            <Trigger Property="WindowState" Value="Maximized">
                <Setter TargetName="PART_ShadowContainer" Property="Margin" Value="0"/>
                <Setter TargetName="PART_WindowBorder" Property="CornerRadius" Value="0"/>
                <Setter TargetName="PART_InnerBorder" Property="CornerRadius" Value="0"/>
                <Setter TargetName="PART_InnerBorder" Property="BorderThickness" Value="0"/>
                <Setter TargetName="PART_WindowBorder" Property="Effect" Value="{x:Null}"/>
                <Setter TargetName="PART_MaximizeRestoreButton" Property="Tag" Value="{StaticResource RestoreIcon}"/>
                <Setter TargetName="PART_MaximizeRestoreButton" Property="ToolTip" Value="还原"/>
                <Setter TargetName="PART_TitleBar" Property="CornerRadius" Value="0"/>
                <Setter TargetName="PART_WindowContent" Property="CornerRadius" Value="0"/>
            </Trigger>
            
            <!-- Drop Shadow Trigger -->
            <Trigger Property="EnableDropShadow" Value="False">
                <Setter TargetName="PART_WindowBorder" Property="Effect" Value="{x:Null}"/>
            </Trigger>
            
            <!-- Title Bar Visibility -->
            <Trigger Property="ShowTitleBar" Value="False">
                <Setter TargetName="PART_TitleBar" Property="Visibility" Value="Collapsed"/>
            </Trigger>
            
            <!-- Icon Visibility -->
            <Trigger Property="Icon" Value="{x:Null}">
                <Setter TargetName="PART_WindowIcon" Property="Visibility" Value="Collapsed"/>
            </Trigger>
            
            <!-- Window Active State -->
            <Trigger Property="IsActive" Value="False">
                <Setter TargetName="PART_WindowBorder" Property="BorderBrush" 
                        Value="{DynamicResource MutedBrush}"/>
                <Setter TargetName="PART_WindowTitle" Property="Foreground" 
                        Value="{DynamicResource MutedForegroundBrush}"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- ShadcnWindow Style -->
    <Style TargetType="{x:Type controls:ShadcnWindow}">
        <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="BorderBrush" Value="Transparent"/>
        <Setter Property="WindowStyle" Value="None"/>
        <Setter Property="AllowsTransparency" Value="True"/>
        <Setter Property="UseLayoutRounding" Value="True"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="TextOptions.TextFormattingMode" Value="Display"/>
        <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
        <Setter Property="TextOptions.TextHintingMode" Value="Fixed"/>
        <Setter Property="RenderOptions.EdgeMode" Value="Unspecified"/>
        <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality"/>
        <Setter Property="RenderOptions.ClearTypeHint" Value="Enabled"/>
        <Setter Property="Template" Value="{StaticResource ShadcnWindowTemplate}"/>
        <Setter Property="MinWidth" Value="300"/>
        <Setter Property="MinHeight" Value="200"/>
        
        <!-- Default Window Chrome Settings -->
        <Setter Property="shell:WindowChrome.WindowChrome">
            <Setter.Value>
                <shell:WindowChrome CaptionHeight="48"
                                    CornerRadius="8"
                                    GlassFrameThickness="0"
                                    ResizeBorderThickness="8"
                                    UseAeroCaptionButtons="False"/>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
